apiVersion: batch/v1
kind: Job
metadata:
  name: rdm-db-migrator
spec:
  backoffLimit: 0
  template:
    spec:
      containers:
        - name: rdm-db-migrator-container
          image: CS_REGISTRY/world-cereal/rdm/dbmigrator:stable
          imagePullPolicy: IfNotPresent
          env:
            - name: ConnectionStrings__Default
              valueFrom:
                secretKeyRef:
                  name: rdm-conn-string-db
                  key: ewocmaster
            - name: ConnectionStrings__RefDb
              valueFrom:
                secretKeyRef:
                  name: rdm-conn-string-db
                  key: referencedb
            - name: ConnectionStrings__ComDb
              valueFrom:
                secretKeyRef:
                  name: rdm-conn-string-db
                  key: communitydb
            - name: BlobBaseUrl
              value: https://S3_BUCKET_URL
      restartPolicy: Never
      imagePullSecrets:
        - name: aws-registry
      nodeSelector:
        system-tag: world-cereal-system